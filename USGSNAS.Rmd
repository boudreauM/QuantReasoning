---
title: "USGS_NAS"
author: "Mariah Boudreau, Kerria Burns, Amanda Jones"
date: "11/1/2019"
output: pdf_document
---
The source is the United States Geological Survey (USGS) Nonindigenous Aquatic 
Species (NAS) data set. It is a collection of zebra mussel sightings across the United States. 
Zebra mussels are an incredibly damaging invasive species in the continental US. They have 
spread drastically over the past several decades, beginning in the Great Lakes.  Included is a 
point map that represents the number of individuals by the color and size of the circle 
superimposed on a map of the United States. Also included is an Excel spreadsheet including 
species identification, latitude and longitude, phase of establishment, and date of sighting, among
other information.
 
Figure 1
Zebra mussel sightings represented by size and color of circle â€“ darker and larger circle correspond to a greater number of individuals. Source: USGS NAS
The map includes Hydraulic Unit Codes (HUC), a system derived by USGS to delimit subregions within the country. 
	An inquiry then could be to standardize each HUC by area to find the number of zebra mussels per unit area to determine at which locations the highest density occurs. Similarly, bins of degrees of latitude could be derived (to reduce the step of standardization and bypass the use of HUC altogether, a possible benefit of which would be that measurements of latitude might yield more climatically relevant data rather than political/economic divisions), to again determine the density of zebra mussels per unit (as yet to be defined). This could be combined with climatic information to determine which climate conditions favor the establishment and invasion of zebra mussels to the most severe extent. A time series could be constructed to see if there were certain time periods that showed more movement than others. The type of analysis could be done on a map similar to the one above to see the visual change as well. 


```{r, echo=FALSE}
dat <- read.csv("NAS-Data-Download.csv")
library(dplyr)
library(ggplot2)
```


```{r, echo = FALSE}

# Checking to unique HUC ID Numbers
as.data.frame(table(dat$HUC.8.Number))
# There are 350 unique HUC ID numbers
# That means there are 350 different locations for this data
```

This chunk will be to filter the unnecessary parts of the data
```{r}
fil_dat <- select(dat, Specimen.Number, Species.ID, Group, Family, Scientific.Name, 
                  Common.Name, Latitude, Longitude, Source, Accuracy, Drainage.Name, 
                  HUC.8.Number, Year, Month, Day, Status)

```



```{r}
# Just looking at some different ways to visualize and understand the data
ggplot(fil_dat, aes(x=dat$HUC.8.Number, y=dat$State)) + geom_point(aes(col=dat$Year), size=3) +labs(title="HUC Number vs. State", subtitle="From USGS Zebra Mussel Dataset", y="State", x="HUC Number")


ggplot(fil_dat, aes(x=dat$HUC.8.Number, y=dat$Year)) + geom_point(aes(col=dat$State), size=3) +labs(title="HUC Number vs. Year", subtitle="From USGS Zebra Mussel Dataset", y="Year", x="HUC Number")


counts <- table(fil_dat$HUC.8.Number)
barplot(counts, main="HUC Distribution", 
   xlab="Number of Occurances in HUC")

# Look into the other large points from the HUC Distribution

max(counts) #684 This occurs in Oneida Lake in NY
which(table(fil_dat$HUC.8.Number) == 684) #4140202

head(fil_dat[fil_dat$HUC.8.Number == 414020200,])


table(fil_dat$HUC.8.Number)


```


#Maps and graph by state and year
```{r}
dat <- read.csv("C:/Users/kmb057/Documents/FundamentalsQuantReasoning/QuantReasoning/NAS-Data-Download.csv")

#remove 0,0 coordinate row
dat <- dat[-5810,]

library(ggplot2)
library(maps)
library(gganimate)
library(dplyr)

#map of the 50 states
US <- map_data("state") 

states <- ggplot(data = US) + 
  geom_polygon(aes(x = long, y = lat, group = group), color = "white") + 
  coord_fixed(1.3) +
  guides(fill=FALSE)

#show change through time from earliest to latest
dat$Year <- sort(dat$Year,decreasing=F)

map1 <- states + geom_point(aes(x=Longitude,y=Latitude,color=Status),data=dat,alpha=0.2)+transition_states(dat$Year)

#population in 2019
latest <- dat[dat$Year=="2019",]
map2 <- states + geom_point(aes(x=Longitude,y=Latitude,color=Status),data=latest,alpha=0.2)

#animation of only those established or collected after 2000
established_collected_post_2000 <- filter(dat[dat$Year>=2000,]) %>%
  filter(Status=="established"|Status=="collected")

established_collected_post_2000$Year <- sort(established_post_2000$Year,decreasing=F)

map3 <- states + geom_point(aes(x=Longitude,y=Latitude,color=Status),data=established_collected_post_2000,alpha=0.2)+transition_states(established_collected_post_2000$Year)+shadow_mark()




#Plot number of zebra mussels sightings per year 
Summarize_sightings_by_year_month <- dat %>% count(Year, Month,State)
plot(Summarize_sightings_by_year_month$Year,Summarize_sightings_by_year_month$n)



ggplot(Summarize_sightings_by_year_month, aes(fill=Summarize_sightings_by_year_month$State, y=Summarize_sightings_by_year_month$n, x=Summarize_sightings_by_year_month$Year)) + 
  geom_bar(position="dodge", stat="identity")
  
#filter data for only Great Lakes lat and long
BorderingGreatLakes <- c("New York","Pennsylvania","Ohio","Indiana","Michigan","Illinois","Wisconsin","Minnesota")
PlottingBorder <- map_data("state", region=BorderingGreatLakes)

Borders <- ggplot(data = PlottingBorder) + 
  geom_polygon(aes(x = long, y = lat, group = group), color = "white") + 
  coord_fixed(1.3) +
  guides(fill=FALSE)+scale_y_continuous(breaks=seq(from=30,to=50,by=1))+scale_x_continuous(breaks=seq(from=-100,to=-70,by=1))


Superior <- dat %>% filter(Latitude>=46 & Latitude<=50) %>% filter(Longitude<=-84.5 & Longitude>=-92)
map4 <- Borders + geom_point(aes(x=Longitude,y=Latitude,color=Status),data=Superior,alpha=0.2)

Michigan <- dat %>% filter(Latitude>=42.5 & Latitude<=46) %>% filter(Longitude<=-84.5 & Longitude>=-88)
map5 <- Borders + geom_point(aes(x=Longitude,y=Latitude,color=Status),data=Michigan,alpha=0.2)

Huron <- dat %>% filter(Latitude>=43 & Latitude<=46) %>% filter(Longitude<=-81.5 & Longitude>=-84)
map6 <- Borders + geom_point(aes(x=Longitude,y=Latitude,color=Status),data=Huron,alpha=0.2)

Erie <- dat %>% filter(Latitude>=41.5 & Latitude<=43) %>% filter(Longitude<=-79 & Longitude>=-84)
map7 <- Borders + geom_point(aes(x=Longitude,y=Latitude,color=Status),data=Erie,alpha=0.2)

Ontario <- dat %>% filter(Latitude>=43.25 & Latitude<=44) %>% filter(Longitude<=-78 & Longitude>=-80)
map8 <- Borders + geom_point(aes(x=Longitude,y=Latitude,color=Status),data=Ontario,alpha=0.2)
  
 #all great Lakes plotted
 GreatLakes <- Borders + 
  geom_point(aes(x=Longitude,y=Latitude,color=Status),data=Superior,alpha=0.2)+
  geom_point(aes(x=Longitude,y=Latitude,color="blue"),data=Michigan,alpha=0.2)+
  geom_point(aes(x=Longitude,y=Latitude,color="green"),data=Huron,alpha=0.2)+
  geom_point(aes(x=Longitude,y=Latitude,color="yellow"),data=Erie,alpha=0.2)+
  geom_point(aes(x=Longitude,y=Latitude,color="purple"),data=Ontario,alpha=0.2)
```



```{r}
#Want to use this chunk to see if there is a correlation between number of occurances in each lake and their size. Linear Regression Analysis. If there isn't a positive correlation then would it be more around tourist areas? or more populated with boating areas. 
 
 # https://www.britannica.com/place/Great-Lakes
 
 #Superior, Michigan, Huron, Erie, Ontario sizes in square miles
 size_of_lake <- c(31700, 22300, 23000, 9910, 7340)
 
 
 sup_counts <-nrow(table(Superior$HUC.8.Number))
 mich_counts <-nrow(table(Michigan$HUC.8.Number))
 huron_counts <-nrow(table(Huron$HUC.8.Number))
 erie_counts <- nrow(table(Erie$HUC.8.Number))
 ont_counts <- nrow(table(Ontario$HUC.8.Number))
 zm_HUC_occurances <-c(sup_counts, mich_counts, huron_counts, erie_counts, ont_counts)
 
 sizeDat <- data.frame(size_of_lake, zm_HUC_occurances)

 
 HUCmodel <- lm(zm_HUC_occurances~size_of_lake, sizeDat)
 summary(HUCmodel)
 
# Call:
#lm(formula = zm_occurances ~ size_of_lake, data = sizeDat)

#Residuals:
#     1      2      3      4      5 
#-6.915 14.778 -4.348  6.011 -9.526 

#Coefficients:
#              Estimate Std. Error t value Pr(>|t|)
#(Intercept)  1.020e+01  1.214e+01    0.84    0.462
#size_of_lake 1.802e-04  5.811e-04    0.31    0.777
 
 # The p-value associated with the coefficient is not a significant value, and therefore not statistically significant. From the model, its states that a unit increase in the size of the lake leads to a 0.0001802 increase in the HUC Occurances.  

#Residual standard error: 11.72 on 3 degrees of freedom
#Multiple R-squared:  0.03104,	Adjusted R-squared:  -0.2919 
#F-statistic: 0.0961 on 1 and 3 DF,  p-value: 0.7768
 
 
 ggplot(sizeDat, aes(x=size_of_lake, y=zm_HUC_occurances)) + geom_point() + geom_smooth(method = "lm") + labs(title="Size of Lake vs. HUC Occurances", subtitle="From USGS Zebra Mussel Dataset", y="HUC Occurances", x="Size of Lake") 
 
 # There is a confidence band around the regression line as well. 

 
```

This chunk will change the years that the HUC data is being looked at in 8 year chunks
```{r}

 SuperiorFirst8 <- dat %>% 
   filter(Latitude>=46 & Latitude<=50) %>% 
   filter(Longitude<=-84.5 & Longitude>=-92) %>% 
   filter(Year <=1999 & Year >= 1991)
 
 SuperiorSecond8 <- dat %>% 
   filter(Latitude>=46 & Latitude<=50) %>% 
   filter(Longitude<=-84.5 & Longitude>=-92) %>% 
   filter(Year <= 2008 & Year >= 2000)

 SuperiorThird8 <- dat %>% 
   filter(Latitude>=46 & Latitude<=50) %>% 
   filter(Longitude<=-84.5 & Longitude>=-92) %>% 
   filter(Year <= 2015 & Year >= 2009)
 
MichiganFirst8 <- dat %>% 
  filter(Latitude>=42.5 & Latitude<=46) %>% 
  filter(Longitude<=-84.5 & Longitude>=-88) %>% 
   filter(Year <=1999 & Year >= 1991)

MichiganSecond8 <- dat %>% 
  filter(Latitude>=42.5 & Latitude<=46) %>% 
  filter(Longitude<=-84.5 & Longitude>=-88) %>% 
   filter(Year <=2008 & Year >= 2000)

MichiganThird8 <- dat %>% 
  filter(Latitude>=42.5 & Latitude<=46) %>% 
  filter(Longitude<=-84.5 & Longitude>=-88) %>% 
   filter(Year <=2015 & Year >= 2009)

HuronFirst8 <- dat %>% 
  filter(Latitude>=43 & Latitude<=46) %>% 
  filter(Longitude<=-81.5 & Longitude>=-84) %>% 
   filter(Year <=1999 & Year >= 1991)

HuronSecond8 <- dat %>% 
  filter(Latitude>=43 & Latitude<=46) %>% 
  filter(Longitude<=-81.5 & Longitude>=-84) %>% 
   filter(Year <=2008 & Year >= 2000)

HuronThird8 <- dat %>% 
  filter(Latitude>=43 & Latitude<=46) %>% 
  filter(Longitude<=-81.5 & Longitude>=-84) %>% 
   filter(Year <=2015 & Year >= 2009)

ErieFirst8 <- dat %>% 
  filter(Latitude>=41.5 & Latitude<=43) %>%
  filter(Longitude<=-79 & Longitude>=-84) %>% 
   filter(Year <=1999 & Year >= 1991)

ErieSecond8 <- dat %>% 
  filter(Latitude>=41.5 & Latitude<=43) %>%
  filter(Longitude<=-79 & Longitude>=-84) %>% 
   filter(Year <=2008 & Year >= 2000)

ErieThird8 <- dat %>% 
  filter(Latitude>=41.5 & Latitude<=43) %>%
  filter(Longitude<=-79 & Longitude>=-84) %>% 
   filter(Year <=2015 & Year >= 2009)

OntarioFirst8 <- dat %>% 
  filter(Latitude>=43.25 & Latitude<=44) %>% 
  filter(Longitude<=-78 & Longitude>=-80) %>% 
   filter(Year <=1999 & Year >= 1991)

OntarioSecond8 <- dat %>% 
  filter(Latitude>=43.25 & Latitude<=44) %>% 
  filter(Longitude<=-78 & Longitude>=-80) %>% 
   filter(Year <=2008 & Year >= 2000)

OntarioThird8 <- dat %>% 
  filter(Latitude>=43.25 & Latitude<=44) %>% 
  filter(Longitude<=-78 & Longitude>=-80) %>% 
   filter(Year <=2015 & Year >= 2009)

```

```{r}
  ## This is the first 8 years of the data (1991-1999)

sup_counts_F8 <-nrow(table(SuperiorFirst8$HUC.8.Number))
 mich_counts_F8 <-nrow(table(MichiganFirst8$HUC.8.Number))
 huron_counts_F8<-nrow(table(HuronFirst8$HUC.8.Number))
 erie_counts_F8 <- nrow(table(ErieFirst8$HUC.8.Number))
 ont_counts_F8 <- nrow(table(OntarioFirst8$HUC.8.Number))
 zm_HUC_occurances_F8 <-c(sup_counts_F8, mich_counts_F8, huron_counts_F8, erie_counts_F8, ont_counts_F8)

  
 sizeDatF8 <- data.frame(size_of_lake, zm_HUC_occurances_F8)

 
 ggplot(sizeDatF8, aes(x=size_of_lake, y=zm_HUC_occurances_F8)) + geom_point() + geom_smooth(method = "lm") + labs(title="Size of Lake vs. HUC Occurances", subtitle="From USGS Zebra Mussel Dataset For First 8 Years", y="HUC Occurances", x="Size of Lake") 
 
```


```{r}
  ## This is the second 8 years of the data (2000-2008)

sup_counts_S8 <-nrow(table(SuperiorSecond8$HUC.8.Number))
 mich_counts_S8 <-nrow(table(MichiganSecond8$HUC.8.Number))
 huron_counts_S8<-nrow(table(HuronSecond8$HUC.8.Number))
 erie_counts_S8 <- nrow(table(ErieSecond8$HUC.8.Number))
 ont_counts_S8 <- nrow(table(OntarioSecond8$HUC.8.Number))
 zm_HUC_occurances_S8 <-c(sup_counts_S8, mich_counts_S8, huron_counts_S8, erie_counts_S8, ont_counts_S8)

  
 sizeDatS8 <- data.frame(size_of_lake, zm_HUC_occurances_S8)

 
 ggplot(sizeDatS8, aes(x=size_of_lake, y=zm_HUC_occurances_S8)) + geom_point() + geom_smooth(method = "lm") + labs(title="Size of Lake vs. HUC Occurances", subtitle="From USGS Zebra Mussel Dataset For Second 8 Years", y="HUC Occurances", x="Size of Lake") 
 
```


```{r}
  ## This is the third 8 years of the data (2009-2015)

sup_counts_T8 <-nrow(table(SuperiorThird8$HUC.8.Number))
 mich_counts_T8 <-nrow(table(MichiganThird8$HUC.8.Number))
 huron_counts_T8<-nrow(table(HuronThird8$HUC.8.Number))
 erie_counts_T8 <- nrow(table(ErieThird8$HUC.8.Number))
 ont_counts_T8 <- nrow(table(OntarioThird8$HUC.8.Number))
 zm_HUC_occurances_T8 <-c(sup_counts_T8, mich_counts_T8, huron_counts_T8, erie_counts_T8, ont_counts_T8)

  
 sizeDatT8 <- data.frame(size_of_lake, zm_HUC_occurances_T8)

 
 ggplot(sizeDatT8, aes(x=size_of_lake, y=zm_HUC_occurances_T8)) + geom_point() + geom_smooth(method = "lm") + labs(title="Size of Lake vs. HUC Occurances", subtitle="From USGS Zebra Mussel Dataset For Third 8 Years", y="HUC Occurances", x="Size of Lake") 
 
```


```{r}
#number of specimens observed as a function of year...not working yet
> length(which(dat$Year=="2007"))
[1] 174
> length(which(dat$Year=="2019"))
[1] 44



dat %>%
  group_by(Year) %>%

 ````
